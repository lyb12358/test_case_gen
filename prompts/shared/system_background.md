### 1. 背景介绍
#### 系统建设背景
用户使用远程控制客户端(如：app)发送远程控制命令到TSP，TSP 将命令下发到到车辆的场景，以便车辆可以按要求执行操作。
#### 系统建设目标
本文档主要介绍远程控制服务包含的主要功能模块，以及每个功能模块的技术设计。
#### 系统角色：
- TSP：Telematics Service Provider，是车联网服务提供商。
- TCAM：Telematics & Connectivity Antenna Module，车联网智能天线模块。
- DHU：Display Head Unit，驾驶信息及娱乐主机。
#### TSP系统架构描述：
架构中包含以下关键组件和流程：
1. 车端设备（device）
   - 车辆作为终端设备，通过网络与云端进行双向通信：
   - 上行：将状态数据（如位置、车况）上传至云端。
   - 下行：接收来自云端的控制指令。
2. 车云通讯模块
   - 使用 MQTT 协议 实现设备与云端的轻量级通信。
   - 消息经由 规则引擎 处理后，转发至 Kafka 消息队列，并按 Topic 分类存储。
   - 支持"指令下发"功能，将控制指令从云端发送回车辆。
3. 远控服务
   - 核心业务逻辑处理单元，负责解析和执行远程控制指令。
   - 包含"业务逻辑"和"车云通讯SDK"模块，与车云通讯模块协同工作。
   - 接收来自移动端或运维平台的请求，处理后触发指令下发。
4. 消息中心
   - 统一的消息分发枢纽，连接各服务模块，确保消息可靠传递。
5. 用户与运维入口
   - 移动设备：用户通过 APP 网关访问系统，实现远程控制、查看车况等操作。
   - 运维平台：运维人员通过运维网关进行系统监控、故障排查、指令下发等管理操作。
6. 支持服务模块
   - 用户设置：管理用户的个性化配置（如告警阈值、权限）。
   - 车况服务：处理和存储车辆状态数据，供查询和分析使用。
7. 数据流向
   - 上行：车辆（TCAM） → MQTT → 规则引擎 → Kafka → 远控服务/消息中心
   - 下行：用户/运维 → 网关 → 远控服务 → 指令下发 → 车辆（TCAM）
#### TSP远控通用业务流程：
以下描述是用户在移动端发起远程操作后，系统各模块之间的协作流程。整体流程分为四个参与方：client（客户端）、APP（应用层）、TSP（车联网服务平台） 和 TCAM（车载终端或车端控制器），该流程是TSP系统架构描述中"远控服务"和"指令下发"部分的行为级细化。它体现了典型的"请求-响应"模式，并引入了"消息推送"机制以提升用户体验,流程步骤如下：
1. client（客户端）
   - 用户进入功能页面，准备进行远程操作。
   - 触发操作后，流程传递至 APP。
2. APP（应用层）
   - 用户点击"远控按钮"。
   - 系统组装指令数据（如设备ID、操作类型等）。
   - 将指令发送至 TSP 服务。
   - 接收来自 TSP 的执行状态反馈。
   - 接收到消息后，通过"消息推送"机制通知前端。
   - 页面刷新，展示最新状态。
   - 流程结束。
3. TSP
   - 接收来自 APP 的指令。
   - 进行业务逻辑处理（如权限校验、参数验证）。
   - 转发指令至 TCAM（车端）。
   - 接收 TCAM 返回的执行状态。
   - 将状态反馈给 APP。
4. TCAM
   - 接收 TSP 下发的指令。
   - 执行具体操作（如锁车、启动发动机等）。
   - 将执行结果（成功/失败/超时等）反馈回 TSP。